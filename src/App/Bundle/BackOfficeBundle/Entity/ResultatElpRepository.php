<?php

namespace App\Bundle\BackOfficeBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * ResultatElpRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ResultatElpRepository extends EntityRepository
{
	public function deleteAll(){
		$this->getEntityManager()->createQuery("delete from AppBackOfficeBundle:ResultatElp")->execute();
	}

	public function getModules( $etudiant, $em, $parent){
		
		$qb = $em->createQueryBuilder();
                $qb->select('r', 'e')
                ->from('App\Bundle\BackOfficeBundle\Entity\ResultatElp', 'r')
                ->join('r.element', 'e')
                ->Where($qb->expr()->eq('r.status', '?1'))
                ->andWhere($qb->expr()->eq('r.etudiant', '?2'))
                //->andWhere($qb->expr()->eq('r.annee', '?4'))
                ->andWhere($qb->expr()->isNotNull('r.note'))
                //->andWhere($qb->expr()->eq('e.nature', '?3'))
                ->andWhere($qb->expr()->eq('e.parent', '?3'))
                ->setParameter(1, "V")
                ->setParameter(2, $etudiant)
                //->setParameter(3, "SM03")  
                //->setParameter(4, $annee) 
                ->setParameter(3, $parent);  
                //$tous_les_modules_valider = $qb->getQuery()->getResult();
                return $qb->getQuery()->getResult();

	}
        public function getSemestres( $annee, $etudiant, $em, $op){
                
                $qb = $em->createQueryBuilder();
                $qb->select('r')
                ->from('App\Bundle\BackOfficeBundle\Entity\ResultatElp', 'r')
                ->join('r.element', 'e')
                //->Where($qb->expr()->eq('r.status', '?1'))
                ->Where($qb->expr()->eq('r.etudiant', '?2'))
                ->andWhere($qb->expr()->eq('r.annee', '?4'))
                //->andWhere($qb->expr()->isNotNull('r.note'))
                ->andWhere(("e.nature like 'SM".$op[0]."' or e.nature like 'SM".$op[1]."' or e.nature like 'SM".$op[2]."' "))                
                
                ->setParameter(2, $etudiant)                
                ->setParameter(4, $annee);  
                return $qb->getQuery()->getResult();

        }

        public function getElements( $etudiant, $em, $parent){
                
                $qb = $em->createQueryBuilder();
                $qb->select('r', 'e')
                ->from('App\Bundle\BackOfficeBundle\Entity\ResultatElp', 'r')
                ->join('r.element', 'e')
                //->Where($qb->expr()->eq('r.status', '?1'))
                ->Where($qb->expr()->eq('r.etudiant', '?2'))
                
                ->andWhere($qb->expr()->isNotNull('r.note'))
                
                ->andWhere($qb->expr()->eq('e.parent', '?3'))
                
                ->setParameter(2, $etudiant)
                
                
                ->setParameter(3, $parent);  
                
                return $qb->getQuery()->getResult();

        }
}
